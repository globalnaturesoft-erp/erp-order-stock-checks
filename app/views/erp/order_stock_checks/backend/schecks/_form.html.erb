<%= form_for([erp_order_stock_checks, :backend, scheck]) do |f| %>
    <div class="form-body">
        <div class="row">
            <div class="col-md-6">
                <div class="portlet light bordered">
                    <div class="portlet-body form">
                        <input type="hidden" value="<%= scheck.order_id %>" name="scheck[order_id]" >
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label><%= t('.order_code') %>:</label>
                                    <div class="form-control">
                                        <span><%= @order.code %></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label><%= t('.order_date') %>:</label>
                                    <div class="form-control">
                                        <span><%= format_date(@order.order_date) %></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label><%= t('.customer') %>:</label>
                            <div class="form-control">
                                <span><%= @order.customer_name %></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="portlet light bordered">
                    <div class="portlet-body form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label><%= t('.salesperson') %>:</label>
                                    <div class="form-control">
                                        <span><%= @order.employee_name %></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label><%= t('.time_request') %>:</label>
                                    <div class="form-control">
                                        <span><%= format_datetime(@order.updated_at) %></span> <!-- @todo thời gian gửi yêu cầu về đề nghị kiểm tra -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <%= erp_form_control("dataselect", {
                            name: 'scheck[employee_id]',
                            value: scheck.employee_id,
                            text: scheck.employee_name,
                            placeholder: t('.choose_storage_staff'),
                            label: t('.storage_staff'),
                            url: erp.dataselect_backend_users_path(format: 'json'),
                            required: true,
                            errors: scheck.errors.full_messages_for(:employee_id)
                        }) %>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="portlet light bordered">
                    <div class="portlet-body form">
                        <div class="row">
                            <div class="col-md-12">
                                <table class="table table-advance table-hover table-striped">
                                    <thead>
                                        <tr>
                                            <th class="text-left text-nowrap"><%= t('.product_name') %></th>
                                            <th class="text-center"><%= t('.product_quantity') %></th>
                                            <th class="text-center"><%= t('.available') %></th>
                                            <% if Erp::Core.available?("ortho_k") %>
                                                <th class="text-left"><%= 'Đ.kiện thay thế' %></th>
                                            <% end %>
                                            <th width="20%" class="text-right"><%= t('.alternative_items') %></th>
                                            <th width="10%"></th>
                                            <th width="15%" class="text-right"><%= t('.note') %></th>
                                        </tr>
                                    </thead>
                                    <tbody class="addableform-container">
                                        <% @scheck.scheck_details.each_with_index do |scheck_detail, index| %>
                                            <input type="hidden" name="scheck[scheck_details_attributes][<%= index.to_s %>][id]" value="<%= scheck_detail.id %>">
                                            <input type="hidden" name="scheck[scheck_details_attributes][<%= index.to_s %>][order_detail_id]" value="<%= scheck_detail.order_detail_id %>">
                                            <tr class="addableform-line">
                                                <td><%= scheck_detail.order_detail.product_name %></td>
                                                <td class="text-center">
                                                    <span class="text-semibold"><%= scheck_detail.order_detail.quantity %></span>
                                                    <br />
                                                    <div class="btn-group">
                                                        <a class="btn btn-sm dropdown-toggle" data-toggle="dropdown" href="javascript:;"> Tồn kho (<%= scheck_detail.order_detail.product.get_stock %>)
                                                            <i class="fa fa-angle-down"></i>
                                                        </a>
                                                        <ul class="dropdown-menu">
                                                            <% Erp::Warehouses::Warehouse.all_active.each do |warehouse| %>
                                                                <li>
                                                                    <a href="javascript:;"> <%= warehouse.name %>
                                                                        <span class="badge badge-success"> <%= scheck_detail.order_detail.product.get_stock(warehouse: warehouse) %> </span>
                                                                    </a>
                                                                </li>
                                                            <% end %>
                                                        </ul>
                                                    </div>
                                                </td>
                                                <td class="text-center">
                                                    <%= erp_form_control('checkbox', {
                                                        name: 'scheck[scheck_details_attributes]['+index.to_s+'][available]',
                                                        id: 'scheck_detail_available',
                                                        value: scheck_detail.available,
                                                        not_selected_value: 'false',
                                                        options: [{value: 'true'}]
                                                    }) %>
                                                </td>
                                                <% if Erp::Core.available?("ortho_k") %>
                                                    <td class="text-left">
                                                        <div><%= 'Cùng mã hàng' if scheck_detail.order_detail.must_same_code? %></div>
                                                        <div><%= 'Cùng đường kính' if scheck_detail.order_detail.must_same_diameter? %></div>
                                                    </td>
                                                <% end %>
                                                <td>
                                                    <%= erp_form_control("dataselect", {
                                                        name: 'scheck[scheck_details_attributes]['+index.to_s+'][alternative_items][]',
                                                        values: Erp::Products::Product.where(id: scheck_detail.get_alternative_item_ids).map {|p| {text: p.name, value: p.id}},
                                                        placeholder: t('.placeholder_alternative_items'),
                                                        url: erp_products.dataselect_backend_products_path(format: 'json'),
                                                        multiple: true
                                                    }) %>
                                                </td>
                                                <td>
                                                    <div class="warehouses-stock-info"
                                                        data-control="<%= '[name="scheck[scheck_details_attributes]['+index.to_s+'][alternative_items][]"]' %>"
                                                        data-url="<%= erp_order_stock_checks.warehouse_info_backend_schecks_path %>"
                                                    >

                                                    </div>
                                                </td>
                                                <td>
                                                   <%= erp_form_control('textarea', {
                                                        name: 'scheck[scheck_details_attributes]['+index.to_s+'][note]',
                                                        value: scheck_detail.note,
                                                        placeholder: t('.placeholder_note'),
                                                        rows: 1
                                                    }) %>
                                                </td>
                                            </tr>
                                        <% end %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <input type='submit' class="btn green-seagreen" name="act_draft" value="<%= t('.submit') %>" />
    <input type='submit' class="btn green-seagreen" name="act_done" value="<%= t('.submit_confirm') %>" />
    <%= erp_component('button/cancel', {
        text: t('.cancel'),
        href: erp_order_stock_checks.backend_schecks_path
    }) %>
<% end %>
